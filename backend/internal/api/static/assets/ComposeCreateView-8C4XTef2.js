import{$ as e,$t as t,Bn as n,D as r,F as i,Gt as a,Kt as o,Ln as s,O as ee,Q as c,Qt as l,U as te,Wt as u,Yt as d,Zt as f,c as p,cn as m,j as h,kn as g,n as _,nt as v,o as y,qt as b,un as x,yn as S,zn as C}from"./ui-CdsL-WMe.js";import{i as w}from"./common-B7iQJWwr.js";import{n as T}from"./index-KvlnPhMc.js";import{t as E}from"./ArrowBackOutline-CaOwIdQt.js";import"./CheckmarkCircleOutline-CNxktTN_.js";import"./CloseCircleOutline-CD61R6IW.js";import{n as D,t as O}from"./ComposeCreateProgress-BjgtEOua.js";import{t as k}from"./CloudUploadOutline-BHaW-Y08.js";import{t as A}from"./FolderOpenOutline-CJB7n3VL.js";import{f as j}from"./utils-5F9W9oaT.js";import"./TermView-Dz1I8qWk.js";import{t as M}from"./compose-CNk9ZZLk.js";var N={class:`compose-create-page`},P={class:`page-header`},F=t({__name:`ComposeCreateView`,setup(t){let F=w(),I=i(),L=T(),R=_(),z=M(),B=g(null),V=g(null),H=g(!1),U=g(!1),W=g(null),G=a(()=>W.value?`calc(100vh - ${W.value.getBoundingClientRect().top+L.safeArea.bottom+56}px)`:`400px`),K=g(),q=g(!1),J=g({name:``,path:``,yaml:``}),Y=a(()=>L.systemInfo?.appPath||`/data/compose`),X=g(``),Z=g(!0),ne={name:[{required:!0,message:`请输入项目名称`,trigger:`blur`},{pattern:/^[a-zA-Z0-9_-]+$/,message:`项目名称只能包含字母、数字、下划线和连字符`,trigger:`blur`},{min:1,max:50,message:`项目名称长度应在 1-50 之间`,trigger:`blur`}],path:[{required:!0,message:`存放路径不能为空`}],yaml:[{required:!0,message:`请输入 Compose 配置`,trigger:`blur`},{validator:()=>Z.value?!0:Error(`YAML 格式不正确`),trigger:`change`}]},re=a(()=>J.value.name&&J.value.path&&J.value.yaml&&Z.value),ie=()=>{let e=J.value.name.trim();e?J.value.path=`${Y.value}/${e}`:J.value.path=``},Q=()=>{let e=j(J.value.yaml);Z.value=e.isValid,X.value=e.errorMessage},ae=()=>{V.value?.click()},oe=async e=>{let t=e.target,n=t.files?.[0];if(n){U.value=!0;try{let e=await n.text();J.value.yaml=e,Q(),I.success(`导入成功`)}catch(e){console.error(`导入文件失败:`,e),I.error(`导入文件失败: ${e.message}`)}finally{U.value=!1,t&&(t.value=``)}}},$=async()=>{if(B.value){try{await B.value.validate()}catch(e){console.error(`表单验证失败:`,e);return}H.value=!0,q.value=!0,K.value?.start()}},se=e=>{I.success(`项目创建并启动成功`),console.log(`Compose file:`,e)},ce=e=>{I.error(`创建失败: ${e}`),H.value=!1},le=()=>{H.value=!1,setTimeout(()=>{z.fetchProjects(!0),F.push({name:`compose`})},2e3)},ue=()=>{F.back()},de=()=>{F.push({name:`compose`})};return m(()=>{L.systemInfo||L.fetchSystemInfo()}),(t,i)=>{let a=te,m=e,g=p,_=v,w=r,T=ee,j=c,M=y,F=h;return x(),d(`div`,N,[(x(),b(u,{to:`#header`,defer:``},[o(`div`,P,[l(m,{text:``,circle:``,onClick:ue},{icon:S(()=>[l(a,{size:`20`},{default:S(()=>[l(s(E))]),_:1})]),_:1}),l(g,{class:`m-0 text-lg`},{default:S(()=>[...i[3]||=[f(`创建 Compose 项目`,-1)]]),_:1})])])),l(j,{title:`基本信息`,size:`small`,bordered:!1,class:`mb-2`},{default:S(()=>[l(T,{ref_key:`formRef`,ref:B,model:J.value,rules:ne,"label-placement":`left`,"label-width":`100`},{default:S(()=>[l(w,{label:`项目名称`,path:`name`},{default:S(()=>[l(_,{value:J.value.name,"onUpdate:value":i[0]||=e=>J.value.name=e,placeholder:`请输入项目名称（支持字母、数字、下划线、连字符）`,onInput:ie,clearable:``},null,8,[`value`])]),_:1}),l(w,{label:`存放路径`,path:`path`},{default:S(()=>[l(_,{value:J.value.path,"onUpdate:value":i[1]||=e=>J.value.path=e,placeholder:`路径将根据项目名称自动生成`,disabled:``,readonly:``},{suffix:S(()=>[l(a,null,{default:S(()=>[l(s(A))]),_:1})]),_:1},8,[`value`])]),_:1})]),_:1},8,[`model`])]),_:1}),l(j,{title:`App 配置`,size:`small`,bordered:!1},{"header-extra":S(()=>[l(F,{align:`center`},{default:S(()=>[l(M,{depth:`3`,class:`text-xs`,style:C({color:s(R).errorColor})},{default:S(()=>[f(n(X.value),1)]),_:1},8,[`style`]),l(m,{text:``,size:`small`,onClick:ae,disabled:U.value,loading:U.value},{icon:S(()=>[l(a,null,{default:S(()=>[l(s(k))]),_:1})]),default:S(()=>[i[4]||=f(` 导入文件 `,-1)]),_:1},8,[`disabled`,`loading`])]),_:1})]),default:S(()=>[o(`div`,{ref_key:`yamlEditorContainerRef`,ref:W},[l(D,{modelValue:J.value.yaml,"onUpdate:modelValue":i[2]||=e=>J.value.yaml=e,placeholder:`请输入 docker-compose.yml 配置内容`,"min-height":G.value,"max-height":`100vh`,onChange:Q},null,8,[`modelValue`,`min-height`])],512),o(`input`,{ref_key:`fileInputRef`,ref:V,type:`file`,accept:`.yml,.yaml`,style:{display:`none`},onChange:oe},null,544)]),_:1}),l(O,{ref_key:`createProgressRef`,ref:K,show:q.value,"project-name":J.value.name,"yaml-content":J.value.yaml,force:!0,onSuccess:se,onError:ce,onComplete:le},null,8,[`show`,`project-name`,`yaml-content`]),(x(),b(u,{to:`#footer`,defer:``},[l(F,{justify:`end`,class:`pr-2`},{default:S(()=>[l(m,{onClick:de,disabled:H.value},{default:S(()=>[...i[5]||=[f(`取消`,-1)]]),_:1},8,[`disabled`]),l(m,{type:`primary`,onClick:$,loading:H.value,disabled:!re.value||H.value},{default:S(()=>[f(n(H.value?`创建中...`:`创建并启动项目`),1)]),_:1},8,[`loading`,`disabled`])]),_:1})]))])}}});export{F as default};
//# sourceMappingURL=ComposeCreateView-8C4XTef2.js.map