{"version":3,"mappings":"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","names":["dataStr: string","message: StatsMessage","error: any"],"ignoreList":[],"sources":["../../node_modules/.pnpm/mitt@3.0.1/node_modules/mitt/dist/mitt.mjs","../../src/evt/containerStats.ts","../../src/hooks/useStatsWebSocket.ts","../../src/store/container.ts"],"sourcesContent":["export default function(n){return{all:n=n||new Map,on:function(t,e){var i=n.get(t);i?i.push(e):n.set(t,[e])},off:function(t,e){var i=n.get(t);i&&(e?i.splice(i.indexOf(e)>>>0,1):n.set(t,[]))},emit:function(t,e){var i=n.get(t);i&&i.slice().map(function(n){n(e)}),(i=n.get(\"*\"))&&i.slice().map(function(n){n(t,e)})}}}\n//# sourceMappingURL=mitt.mjs.map\n","import type { ContainerStatus } from '@/common/types'\nimport mitt from 'mitt'\ntype Events = {\n  containers: ContainerStatus[]\n}\nconst emitter = mitt<Events>()\n\nexport default emitter\n","import type { ContainerStats, ContainerStatus } from '@/common/types'\nimport { useSettingStore } from '@/store/setting'\nimport { useWebSocket } from '@vueuse/core'\nimport { computed } from 'vue'\nimport statsEmitter from '@/evt/containerStats'\nexport interface StatsMessage {\n  type: string\n  data: {\n    stats?: Record<string, ContainerStats>\n    containers?: ContainerStatus[]\n  }\n  timestamp: number\n}\n\n/**\n * 容器统计数据 WebSocket Composable\n * 基于 VueUse 的 useWebSocket 实现\n */\nexport default function useStatsWebSocket() {\n  const settingStore = useSettingStore()\n\n  // 计算 WebSocket URL\n  const wsUrl = computed(() => {\n    const token = settingStore.getToken()\n    if (!token) {\n      return undefined\n    }\n\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:'\n    const host = window.location.host\n    return `${protocol}//${host}/api/v1/containers/stats/ws?token=${token}`\n  })\n\n  // 使用 VueUse 的 useWebSocket\n  const { status, send, open, close, ws } = useWebSocket(wsUrl, {\n    // 自动重连配置\n    autoReconnect: {\n      retries: 5,\n      delay: 2000,\n      onFailed() {\n        console.error('WebSocket 重连失败，已达到最大重试次数')\n      },\n    },\n    // Safari 兼容性：禁用客户端心跳，依赖服务端的 Ping/Pong 机制\n    // Safari 不太支持客户端主动发送的文本心跳消息\n    heartbeat: false,\n    // 立即连接\n    immediate: false,\n    // URL变化时自动重连\n    autoConnect: true,\n    // 页面卸载时自动关闭\n    autoClose: true,\n    // 连接成功回调\n    onConnected(ws) {\n      console.log('Stats WebSocket 连接已建立')\n      // Safari 兼容性：设置二进制类型\n      if (ws) {\n        ws.binaryType = 'arraybuffer'\n      }\n    },\n    // 连接断开回调\n    onDisconnected(_, event) {\n      console.log('Stats WebSocket 连接已断开:', event.code, event.reason)\n      // 1006 表示异常关闭，通常是网络问题或服务端问题\n      if (event.code === 1006) {\n        console.warn('WebSocket 异常关闭 (1006)，可能是网络问题或服务端问题')\n      }\n    },\n    // 连接错误回调\n    onError(_, error) {\n      console.error('Stats WebSocket 连接错误:', error)\n    },\n    // 消息接收回调\n    onMessage(_, event) {\n      try {\n        let dataStr: string\n        // 处理二进制消息\n        if (event.data instanceof ArrayBuffer) {\n          const decoder = new TextDecoder('utf-8')\n          dataStr = decoder.decode(event.data)\n        } else if (typeof event.data === 'string') {\n          // 兼容文本消息\n          dataStr = event.data\n        } else {\n          console.error('未知的消息类型:', typeof event.data)\n          return\n        }\n        try {\n          const message: StatsMessage = JSON.parse(dataStr)\n          if (message.type === 'containers' && message.data.containers) {\n            // console.debug('onMessage', message.data.containers)\n            statsEmitter.emit('containers', message.data.containers)\n          }\n        } catch (error) {\n          console.error('解析 JSON 消息失败:', error, 'Data:', dataStr)\n        }\n      } catch (error) {\n        console.error('处理 WebSocket 消息失败:', error)\n      }\n    },\n  })\n\n  // 连接状态映射\n  const connectionState = computed(() => {\n    switch (status.value) {\n      case 'CONNECTING':\n        return 'connecting'\n      case 'OPEN':\n        return 'connected'\n      case 'CLOSED':\n        return 'disconnected'\n      default:\n        return 'disconnected'\n    }\n  })\n\n  // 是否已连接\n  const isConnected = computed(() => status.value === 'OPEN')\n\n  // 启动连接\n  const connect = () => {\n    if (isConnected.value) {\n      return\n    }\n    console.debug('connect')\n    if (wsUrl.value) {\n      open()\n    } else {\n      console.warn('无法启动 WebSocket 连接：缺少有效的 token')\n    }\n  }\n\n  // 断开连接\n  const disconnect = () => {\n    close()\n  }\n\n  // 重新连接\n  const reconnect = () => {\n    console.debug('reconnect')\n    if (status.value === 'OPEN') {\n      disconnect()\n    }\n    setTimeout(() => {\n      connect()\n    }, 100)\n  }\n\n  return {\n    // 状态\n    status,\n    connectionState,\n    isConnected,\n    ws,\n\n    // 方法\n    connect,\n    disconnect,\n    reconnect,\n    send,\n  }\n}\n","import { containerApi } from '@/common/api'\nimport type { BatchUpdateResult, ContainerStatus } from '@/common/types'\nimport useStatsWebSocket from '@/hooks/useStatsWebSocket'\nimport { defineStore } from 'pinia'\nimport { computed, ref } from 'vue'\nimport statsEmitter from '@/evt/containerStats'\n\nexport const useContainerStore = defineStore('container', () => {\n  // 状态\n  const containers = ref<ContainerStatus[]>([])\n  const loading = ref(false)\n  const updating = ref(new Set<string>())\n  const batchUpdating = ref(false)\n\n  // WebSocket 相关状态\n  const statsWebSocket = useStatsWebSocket()\n  const wsConnected = computed(() => statsWebSocket.isConnected.value)\n  const wsConnectionState = computed(() => statsWebSocket.connectionState.value)\n\n  // 计算属性\n  const runningContainers = computed(() => containers.value.filter((c) => c.running))\n\n  const stoppedContainers = computed(() => containers.value.filter((c) => !c.running))\n\n  const updateableContainers = computed(() =>\n    containers.value.filter((c) => c.status === 'UpdateAvailable' && !c.skipped),\n  )\n\n  const upToDateContainers = computed(() => containers.value.filter((c) => c.status === 'UpToDate'))\n\n  const errorContainers = computed(() => containers.value.filter((c) => c.status === 'Error'))\n\n  const skippedContainers = computed(() => containers.value.filter((c) => c.skipped))\n\n  // 统计信息\n  const stats = computed(() => ({\n    total: containers.value.length,\n    running: runningContainers.value.length,\n    stopped: stoppedContainers.value.length,\n    updateable: updateableContainers.value.length,\n    upToDate: upToDateContainers.value.length,\n    error: errorContainers.value.length,\n    skipped: skippedContainers.value.length,\n  }))\n\n  // 方法：获取容器列表\n  const fetchContainers = async (isUserCache = true, isHaveUpdate = true) => {\n    loading.value = true\n    try {\n      const data = await containerApi.getContainers(isUserCache, isHaveUpdate)\n      if (data.code === 0) {\n        // 按照 ID 进行合并，新数据覆盖旧数据\n        const newContainers = data.data.containers\n        const existingContainersMap = new Map(containers.value.map((c) => [c.id, c]))\n\n        containers.value = newContainers.map((newContainer) => {\n          const existingContainer = existingContainersMap.get(newContainer.id)\n          // 如果存在旧容器，合并数据，新数据覆盖旧数据\n          if (existingContainer) {\n            const res = { ...existingContainer, ...newContainer }\n            return res\n          }\n          // 如果是新容器，直接使用新数据\n          return newContainer\n        })\n      } else {\n        console.error('获取容器列表失败:', data.msg)\n        throw new Error(data.msg)\n      }\n    } catch (error) {\n      console.error('获取容器列表失败:', error)\n      throw error\n    } finally {\n      loading.value = false\n    }\n  }\n\n  // 方法：更新单个容器\n  const updateContainer = async (id: string, image?: string): Promise<boolean> => {\n    updating.value.add(id)\n    try {\n      const data = await containerApi.updateContainer(id, image)\n      if (data.code === 0) {\n        await fetchContainers() // 重新获取列表\n        return true\n      } else {\n        throw new Error(data.msg)\n      }\n    } catch (error) {\n      console.error('更新容器失败:', error)\n      throw error\n    } finally {\n      updating.value.delete(id)\n    }\n  }\n\n  // 方法：批量更新容器\n  const batchUpdate = async (): Promise<BatchUpdateResult> => {\n    batchUpdating.value = true\n    try {\n      const data = await containerApi.batchUpdate()\n      if (data.code === 0) {\n        await fetchContainers() // 重新获取列表\n        return data.data\n      } else {\n        throw new Error(data.msg)\n      }\n    } catch (error) {\n      console.error('批量更新失败:', error)\n      throw error\n    } finally {\n      batchUpdating.value = false\n    }\n  }\n\n  // 方法：启动容器\n  const startContainer = async (id: string): Promise<boolean> => {\n    try {\n      const data = await containerApi.startContainer(id)\n      if (data.code === 0) {\n        await fetchContainers() // 重新获取列表\n        return true\n      } else {\n        throw new Error(data.msg)\n      }\n    } catch (error) {\n      console.error('启动容器失败:', error)\n      throw error\n    }\n  }\n\n  // 方法：停止容器\n  const stopContainer = async (id: string): Promise<boolean> => {\n    try {\n      const data = await containerApi.stopContainer(id)\n      if (data.code === 0) {\n        await fetchContainers() // 重新获取列表\n        return true\n      } else {\n        throw new Error(data.msg)\n      }\n    } catch (error) {\n      console.error('停止容器失败:', error)\n\n      throw error\n    }\n  }\n\n  // 方法：重启容器\n  const restartContainer = async (id: string): Promise<boolean> => {\n    try {\n      const data = await containerApi.restartContainer(id)\n      if (data.code === 0) {\n        await fetchContainers() // 重新获取列表\n        return true\n      } else {\n        throw new Error(data.msg)\n      }\n    } catch (error) {\n      console.error('重启容器失败:', error)\n      throw error\n    }\n  }\n\n  // 方法：删除容器\n  const deleteContainer = async (id: string, force: boolean = false, removeVolumes: boolean = false, removeNetworks: boolean = false): Promise<boolean> => {\n    try {\n      const data = await containerApi.deleteContainer(id, force, removeVolumes, removeNetworks)\n      if (data.code === 0) {\n        await fetchContainers() // 重新获取列表\n        return true\n      } else {\n        throw new Error(data.msg)\n      }\n    } catch (error) {\n      console.error('删除容器失败:', error)\n      throw error\n    }\n  }\n\n  // 方法：根据ID查找容器\n  const findContainerById = (id: string) => {\n    return containers.value.find((c) => c.id === id)\n  }\n\n  // 方法：根据名称查找容器\n  const findContainerByName = (name: string) => {\n    return containers.value.find((c) => c.name === name)\n  }\n\n  // 方法：根据项目名称获取容器列表\n  const getProjectContainers = (projectName: string) => {\n    return computed(() => {\n      return containers.value.filter((container) => {\n        return container.labels?.['com.docker.compose.project'] === projectName\n      })\n    })\n  }\n\n  // 方法：检查容器是否正在更新\n  const isContainerUpdating = (id: string) => {\n    return updating.value.has(id)\n  }\n\n  // WebSocket 容器数据回调处理\n  const handleContainersUpdate = (newContainers: ContainerStatus[]) => {\n    // console.debug('WebSocket received containers update:', newContainers.length, 'containers')\n    // 直接使用WebSocket接收到的完整容器数据，包括stats\n    const mapContainers = new Map<string, ContainerStatus>()\n    newContainers.forEach((container) => {\n      mapContainers.set(container.id, container)\n    })\n    const oldContainers = [...containers.value]\n    containers.value = oldContainers.map((container) => {\n      const newContainer = mapContainers.get(container.id)\n      if (newContainer) {\n        return newContainer\n      }\n      return container\n    })\n  }\n\n  statsEmitter.on('containers', handleContainersUpdate)\n\n  // 方法：导出容器\n  const exportContainer = async (id: string): Promise<boolean> => {\n    try {\n      // 获取当前的token\n      const { getToken } = await import('@/common/axiosConfig')\n      const token = getToken()\n\n      // 构建下载URL，将token作为查询参数\n      const baseUrl = '/api/v1'\n      const downloadUrl = `${baseUrl}/containers/${id}/export?token=${encodeURIComponent(\n        token,\n      )}&_t=${Date.now()}`\n\n      // 使用window.open直接下载，浏览器会处理大文件和进度\n      const downloadWindow = window.open(downloadUrl, '_blank')\n\n      // 检查是否成功打开了下载窗口\n      if (!downloadWindow) {\n        throw new Error('浏览器阻止了弹窗，请允许弹窗后重试')\n      }\n\n      return true\n    } catch (error: any) {\n      console.error('导出容器失败:', error)\n      throw error\n    }\n  }\n\n  // 方法：获取容器详情\n  const getContainerDetail = async (id: string): Promise<any> => {\n    try {\n      const data = await containerApi.getContainerDetail(id)\n      if (data.code === 0) {\n        return data.data.container\n      } else {\n        throw new Error(data.msg)\n      }\n    } catch (error) {\n      console.error('获取容器详情失败:', error)\n      throw error\n    }\n  }\n\n  return {\n    // 状态\n    containers,\n    loading,\n    updating,\n    batchUpdating,\n    wsConnected,\n    wsConnectionState,\n\n    // 计算属性\n    runningContainers,\n    stoppedContainers,\n    updateableContainers,\n    upToDateContainers,\n    errorContainers,\n    skippedContainers,\n    stats,\n\n    // 方法\n    fetchContainers,\n    updateContainer,\n    batchUpdate,\n    startContainer,\n    stopContainer,\n    restartContainer,\n    deleteContainer,\n    findContainerById,\n    findContainerByName,\n    getProjectContainers,\n    isContainerUpdating,\n    exportContainer,\n    getContainerDetail,\n    statsWebSocket,\n  }\n})\n"],"file":"container-BbVEwPu1.js"}