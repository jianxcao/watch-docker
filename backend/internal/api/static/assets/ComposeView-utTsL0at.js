import{$ as e,$t as t,Bn as n,Gt as r,H as i,Ht as a,Jt as o,Kt as s,Ln as c,Qt as l,Rn as u,U as d,Ut as f,Wt as p,Yt as m,Zt as h,_n as g,at as _,c as v,cn as y,fn as b,j as ee,kn as x,m as S,nt as C,o as w,qt as T,un as E,vn as D,yn as O}from"./ui-CdsL-WMe.js";import{i as k,o as A}from"./common-B7iQJWwr.js";import{n as j,t as M}from"./index-KvlnPhMc.js";import{t as N}from"./useResponsive-C7zPy5Go.js";import{t as P}from"./AddCircleOutline-CgU-IXa-.js";import{i as te,n as ne,r as re,t as ie}from"./TextOutline-DfkX3I5u.js";import{t as F}from"./CloudDownloadOutline-CsoTk8An.js";import{t as ae}from"./LayersOutline-CZcJsfbA.js";import{n as I,r as L}from"./LogsStreamView-DMg69Ziz.js";import{t as oe}from"./RadioButtonOnOutline-B_Feh0aZ.js";import{t as R}from"./RefreshOutline-DFsFZU2a.js";import{i as z,n as se,r as B,t as V}from"./useCompose-Cxsar_gr.js";import{t as ce}from"./SearchOutline-DMbt0-Bv.js";import{t as H}from"./TrashOutline-BLUdX-Eg.js";import{d as le,l as U}from"./utils-5F9W9oaT.js";import{t as W}from"./compose-BeaxuMAs.js";import{t as G}from"./log-BiY5VKye.js";import"./TermView-Dz1I8qWk.js";import{t as ue}from"./compose-CNk9ZZLk.js";import{t as K}from"./overflowMenuVertical-DNua2xYl.js";var q={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 512 512`},de=t({name:`WarningOutline`,render:function(e,t){return E(),m(`svg`,q,t[0]||=[s(`path`,{d:`M85.57 446.25h340.86a32 32 0 0 0 28.17-47.17L284.18 82.58c-12.09-22.44-44.27-22.44-56.36 0L57.4 399.08a32 32 0 0 0 28.17 47.17z`,fill:`none`,stroke:`currentColor`,"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`32`},null,-1),s(`path`,{d:`M250.26 195.39l5.74 122l5.73-121.95a5.74 5.74 0 0 0-5.79-6h0a5.74 5.74 0 0 0-5.68 5.95z`,fill:`none`,stroke:`currentColor`,"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`32`},null,-1),s(`path`,{d:`M256 397.25a20 20 0 1 1 20-20a20 20 0 0 1-20 20z`,fill:`currentColor`},null,-1)])}}),J=[`data-theme`],Y={class:`card-content`},X={class:`project-header`},Z={class:`project-info`},Q={class:`project-title-row`},fe={class:`project-name`},$={class:`project-meta`},pe={class:`status-text`},me={class:`container-counts`},he={class:`count-badge total-count`},ge=M(t({__name:`ComposeCard`,props:{project:{},loading:{type:Boolean}},emits:[`log`],setup(t,{emit:p}){let{handleStart:g,handleStop:_,handleRestart:v,handleDelete:y,handleCreate:b}=V(),ee=k(),S=x(!1),C=p,w=t,D=j(),A=e=>({running:`运行中`,partial:`部分运行`,exited:`已停止`,paused:`暂停`,draft:`草稿`,created_stack:`创建中`,unknown:`未知`})[e]||`未知`,M=r(()=>{let e=[],t=w.project;if((t.status===`exited`||t.status===`partial`)&&e.push({label:`启动`,key:`start`,icon:U(L)}),(t.status===`running`||t.status===`partial`)&&e.push({label:`停止`,key:`stop`,icon:U(I)},{label:`重启`,key:`restart`,icon:U(z)}),e.push({label:`创建`,key:`create`,icon:U(R)},{type:`divider`,key:`divider1`},{label:`拉取镜像`,key:`pull`,icon:U(F)},{label:`日志`,key:`logs`,icon:U(G)}),t.status!==`unknown`){let n=`删除应用`;(t.status===`draft`||t.status===`created_stack`)&&(n=`删除配置`),e.push({type:`divider`,key:`divider2`},{label:n,key:`delete`,icon:U(H),props:{style:`color: #ff4d4f`}})}return e}),N=()=>{ee.push({name:`compose-detail`,params:{projectName:w.project.name}})},P=e=>{switch(e){case`start`:g(w.project);break;case`stop`:_(w.project);break;case`restart`:v(w.project);break;case`delete`:y(w.project);break;case`view-logs`:C(`log`);break;case`create`:b(w.project);break;case`pull`:S.value=!0;break}};return(r,p)=>{let g=e,_=i;return E(),m(f,null,[s(`div`,{class:u([`compose-card`,[`card-status-`+t.project.status,{"card-updating":t.loading}]]),"data-theme":c(D).setting.theme,onClick:N},[s(`div`,Y,[s(`div`,X,[s(`div`,{class:u([`project-logo`,`logo-`+t.project.status])},[l(c(d),{size:`20`,class:`logo-icon`},{default:O(()=>[l(c(W))]),_:1})],2),s(`div`,Z,[s(`div`,Q,[s(`div`,fe,n(t.project.name),1),l(_,{options:M.value,onSelect:P,trigger:`click`},{default:O(()=>[l(g,{quaternary:``,circle:``,size:`small`,class:`menu-btn`,onClick:p[0]||=a(()=>{},[`stop`])},{icon:O(()=>[l(c(d),null,{default:O(()=>[l(c(K))]),_:1})]),_:1})]),_:1},8,[`options`])]),s(`div`,$,[s(`div`,{class:u([`status-badge`,`status-`+t.project.status])},[p[8]||=s(`span`,{class:`status-dot`},null,-1),s(`span`,pe,n(A(t.project.status)),1)],2),s(`div`,me,[s(`div`,he,[l(c(d),{size:`12`,class:`count-icon`},{default:O(()=>[l(c(ae))]),_:1}),s(`span`,null,n(t.project.createdCount+t.project.runningCount+t.project.exitedCount),1)]),s(`div`,{class:u([`count-badge running-count`,{"has-running":t.project.runningCount>0}])},[p[9]||=s(`span`,{class:`running-dot`},null,-1),s(`span`,null,n(t.project.runningCount),1)],2)])])])]),s(`div`,{class:`action-buttons`,onClick:p[6]||=a(()=>{},[`stop`])},[t.project.status===`exited`||t.project.status===`partial`?(E(),T(g,{key:0,text:``,class:`action-btn`,onClick:p[1]||=e=>P(`start`)},{icon:O(()=>[l(c(d),null,{default:O(()=>[l(c(L))]),_:1})]),default:O(()=>[p[10]||=h(` 启动 `,-1)]),_:1})):o(``,!0),t.project.status===`running`||t.project.status===`partial`?(E(),T(g,{key:1,text:``,class:`action-btn`,onClick:p[2]||=e=>P(`stop`)},{icon:O(()=>[l(c(d),null,{default:O(()=>[l(c(I))]),_:1})]),default:O(()=>[p[11]||=h(` 停止 `,-1)]),_:1})):o(``,!0),t.project.status===`running`?(E(),T(g,{key:2,text:``,class:`action-btn`,onClick:p[3]||=e=>P(`restart`)},{icon:O(()=>[l(c(d),null,{default:O(()=>[l(c(z))]),_:1})]),default:O(()=>[p[12]||=h(` 重启 `,-1)]),_:1})):o(``,!0),t.project.status===`unknown`||t.project.status===`exited`||t.project.status===`draft`?(E(),T(g,{key:3,text:``,class:`action-btn`,onClick:p[4]||=e=>P(`create`)},{icon:O(()=>[l(c(d),null,{default:O(()=>[l(c(R))]),_:1})]),default:O(()=>[p[13]||=h(` 创建 `,-1)]),_:1})):o(``,!0),l(g,{text:``,class:`action-btn`,onClick:p[5]||=e=>P(`view-logs`)},{icon:O(()=>[l(c(d),null,{default:O(()=>[l(c(G))]),_:1})]),default:O(()=>[p[14]||=h(` 日志 `,-1)]),_:1})])])],10,J),l(B,{show:S.value,"onUpdate:show":p[7]||=e=>S.value=e,project:t.project},null,8,[`show`,`project`])],64)}}}),[[`__scopeId`,`data-v-66af94c4`]]),_e={class:`compose-page`},ve={class:`compose-content`},ye={key:0,class:`empty-state`},be={class:`welcome-card`},xe={class:`flex gap-2`},Se=M(t({__name:`ComposeView`,setup(t){let a=k(),o=x(!1),j=x(null),M=ue(),{handleRefresh:F}=V(),{isMobile:ae,isTablet:z,isLaptop:B,isDesktop:H,isDesktopLarge:W}=N(),G=x(``),K=x(``),q=x(`name`),J=x(`asc`),Y=e=>{j.value=e,o.value=!0},X=()=>{a.push({name:`compose-create`})};D(()=>{o.value||(j.value=null)});let Z=r(()=>[{label:`全部状态`,key:``,icon:U(te)},{label:`运行中`,key:`running`,icon:U(L)},{label:`已停止`,key:`exited`,icon:U(I)},{label:`其他`,key:`other`,icon:U(de)}]),Q=r(()=>[{label:`名称 ${q.value===`name`?J.value===`asc`?`↑`:`↓`:``}`,key:`name`,icon:U(ie)},{label:`状态 ${q.value===`status`?J.value===`asc`?`↑`:`↓`:``}`,key:`status`,icon:U(oe)}]),fe=r(()=>q.value!==`name`||J.value!==`asc`),$=r(()=>{let e=M.projects;if(K.value&&(e=e.filter(e=>K.value===`other`?e.status!==`running`&&e.status!==`exited`:e.status===K.value)),G.value){let t=G.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t))}return e=[...e].sort((e,t)=>{let n=0;switch(q.value){case`name`:n=e.name.localeCompare(t.name);break;case`status`:n=e.status.localeCompare(t.status);break;default:n=e.name.localeCompare(t.name)}return J.value===`desc`?-n:n}),e}),pe=e=>{K.value=e},me=e=>{q.value===e?J.value=J.value===`asc`?`desc`:`asc`:(q.value=e,J.value=`asc`)};return y(async()=>{try{await M.fetchProjects()}catch(e){console.error(`初始化 Compose 项目数据失败:`,e)}}),g(A(),e=>{e===`visible`&&le(1e3).then(()=>{M.fetchProjects()})}),(t,r)=>{let a=e,g=i,y=C,x=ee,D=_,k=S,A=v,N=w;return E(),m(`div`,_e,[l(x,null,{default:O(()=>[l(g,{options:Z.value,onSelect:pe},{default:O(()=>[l(a,{circle:``,size:`small`,type:K.value?`primary`:`default`},{icon:O(()=>[l(c(d),null,{default:O(()=>[l(c(re))]),_:1})]),_:1},8,[`type`])]),_:1},8,[`options`]),l(g,{options:Q.value,onSelect:me},{default:O(()=>[l(a,{circle:``,size:`small`,type:fe.value?`primary`:`default`},{icon:O(()=>[l(c(d),null,{default:O(()=>[l(c(ne))]),_:1})]),_:1},8,[`type`])]),_:1},8,[`options`]),l(y,{value:G.value,"onUpdate:value":r[0]||=e=>G.value=e,placeholder:`搜索项目名称或路径`,style:{width:`200px`},clearable:``},{prefix:O(()=>[l(c(d),null,{default:O(()=>[l(c(ce))]),_:1})]),_:1},8,[`value`])]),_:1}),s(`div`,ve,[l(k,{show:c(M).loading&&$.value.length===0},{default:O(()=>[$.value.length===0&&!c(M).loading?(E(),m(`div`,ye,[l(D,{description:`没有找到 Compose 项目`},{extra:O(()=>[l(a,{onClick:c(F)},{default:O(()=>[...r[2]||=[h(`刷新数据`,-1)]]),_:1},8,[`onClick`])]),_:1})])):(E(),m(`div`,{key:1,class:u([`compose-grid`,{"grid-cols-1":c(ae),"grid-cols-2":c(z)||c(B),"grid-cols-3":c(H),"grid-cols-4":c(W)}])},[(E(!0),m(f,null,b($.value,e=>(E(),T(ge,{key:e.name,project:e,loading:c(M).isProjectOperating(e.name).value,onLog:()=>Y(e)},null,8,[`project`,`loading`,`onLog`]))),128))],2))]),_:1},8,[`show`])]),(E(),T(p,{to:`#header`,defer:``},[s(`div`,be,[s(`div`,null,[l(A,{class:`m-0 text-lg`},{default:O(()=>[...r[3]||=[h(` Compose 项目管理 `,-1)]]),_:1}),l(N,{depth:`3`,class:`text-xs max-md:hidden`},{default:O(()=>[h(` 共 `+n(c(M).stats.total)+` 个项目， `+n(c(M).stats.running)+` 个运行中 `,1)]),_:1})]),s(`div`,xe,[l(a,{circle:``,size:`tiny`,type:`primary`,onClick:X},{icon:O(()=>[l(c(d),null,{default:O(()=>[l(c(P))]),_:1})]),_:1}),l(a,{onClick:c(F),loading:c(M).loading,circle:``,size:`tiny`},{icon:O(()=>[l(c(d),null,{default:O(()=>[l(c(R))]),_:1})]),_:1},8,[`onClick`,`loading`])])])])),l(se,{show:o.value,"onUpdate:show":r[1]||=e=>o.value=e,project:j.value},null,8,[`show`,`project`])])}}}),[[`__scopeId`,`data-v-dc6e6b95`]]);export{Se as default};
//# sourceMappingURL=ComposeView-utTsL0at.js.map