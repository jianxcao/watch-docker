const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/axiosConfig-BTZ6bNNN.js","assets/index-KvlnPhMc.js","assets/ui-CdsL-WMe.js","assets/common-B7iQJWwr.js","assets/rolldown-runtime-DGruFWvd.js","assets/index-Cyqp8d2B.css"])))=>i.map(i=>d[i]);
import{Gt as e,kn as t}from"./ui-CdsL-WMe.js";import{d as n,l as r}from"./common-B7iQJWwr.js";import{c as i,h as a}from"./index-KvlnPhMc.js";import{t as o}from"./utils-5F9W9oaT.js";const s=n(`image`,()=>{let n=t([]),s=t(!1),c=t(new Set),l=t(new Set),u=t(!1),d=e=>!e.repoTags||e.repoTags.length===0||e.repoTags.every(e=>e===`<none>:<none>`),f=e(()=>n.value.filter(e=>!d(e))),p=e(()=>f.value.length),m=e(()=>f.value.reduce((e,t)=>e+t.size,0)),h=e(()=>o(m.value)),g=e(()=>({total:p.value,totalSize:m.value,formattedTotalSize:h.value})),_=async()=>{s.value=!0;try{let e=await i.getImages();if(e.code===0)n.value=e.data.images;else throw console.error(`获取镜像列表失败:`,e.msg),Error(e.msg)}catch(e){throw console.error(`获取镜像列表失败:`,e),e}finally{s.value=!1}},{pause:v,resume:y}=r(_,1e4,{immediate:!1});return{images:n,normalImages:f,loading:s,deleting:c,downloading:l,importing:u,totalImages:p,totalSize:m,formattedTotalSize:h,stats:g,danglingImages:e(()=>n.value.filter(e=>d(e))),fetchImages:_,deleteImage:async(e,t=!1)=>{c.value.add(e);try{let n=await i.deleteImage(e,t);if(n.code===0)return await _(),!0;throw Error(n.msg)}catch(e){throw console.error(`删除镜像失败:`,e),e}finally{c.value.delete(e)}},downloadImage:async e=>{l.value.add(e);try{let{getToken:t}=await a(async()=>{let{getToken:e}=await import(`./axiosConfig-BTZ6bNNN.js`);return{getToken:e}},__vite__mapDeps([0,1,2,3,4,5])),n=t(),r=`/api/v1/images/${e}/download?token=${encodeURIComponent(n)}&_t=${Date.now()}`;if(!window.open(r,`_blank`))throw Error(`浏览器阻止了弹窗，请允许弹窗后重试`);return setTimeout(()=>{l.value.delete(e)},1e3),!0}catch(t){throw console.error(`下载镜像失败:`,t),l.value.delete(e),t}},importImage:async e=>{u.value=!0;try{let t=await i.importImage(e);if(t.code===0)return await _(),!0;throw Error(t.msg||`导入失败`)}catch(e){throw console.error(`导入镜像失败:`,e),e.response?.data?.error?Error(e.response.data.error):e}finally{u.value=!1}},findImageById:e=>n.value.find(t=>t.id===e),findImagesByTag:e=>n.value.filter(t=>t.repoTags.some(t=>t.includes(e))),isImageDeleting:e=>c.value.has(e),isImageDownloading:e=>l.value.has(e),getImageDisplayTag:e=>{if(e.repoTags&&e.repoTags.length>0){let t=e.repoTags.filter(e=>e!==`<none>:<none>`);if(t.length>0)return t[0]}return e.id.startsWith(`sha256:`)?e.id.slice(7,19):e.id.slice(0,12)},getDisplayId:e=>e.id.startsWith(`sha256:`)?e.id.slice(7,19):e.id.slice(0,12),isDanglingImage:d,stopImagesPolling:v,startImagesPolling:y}});export{s as t};
//# sourceMappingURL=image-Bt3Khyum.js.map