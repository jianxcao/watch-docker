import{$ as e,$t as t,Bn as n,F as r,Gt as i,H as ee,Jt as a,Kt as o,Ln as s,Qt as c,Rn as l,U as te,Ut as u,Wt as ne,Yt as d,Zt as f,_n as p,at as re,c as ie,cn as m,d as ae,et as oe,f as se,fn as ce,kn as h,m as le,n as g,o as ue,qt as _,un as v,yn as y,z as b,zn as de}from"./ui-CdsL-WMe.js";import{i as x,r as S}from"./common-B7iQJWwr.js";import{n as C,t as w}from"./index-KvlnPhMc.js";import{t as fe}from"./useResponsive-C7zPy5Go.js";import{t as pe}from"./ArrowBackOutline-CaOwIdQt.js";import"./CheckmarkCircleOutline-CNxktTN_.js";import"./CloseCircleOutline-CD61R6IW.js";import{t as me}from"./CloudDownloadOutline-CsoTk8An.js";import{n as he,t as ge}from"./ComposeCreateProgress-BjgtEOua.js";import"./CloudUploadOutline-BHaW-Y08.js";import{n as _e,r as ve,t as ye}from"./ContainerLogsModal-CQm0hYa9.js";import"./DownloadOutline-C4KnaRUa.js";import{t as be}from"./EllipsisHorizontal-CWTmMJqt.js";import"./InformationCircleOutline-DxVonW4c.js";import{t as xe}from"./LayersOutline-CZcJsfbA.js";import{n as Se,r as Ce,t as we}from"./LogsStreamView-DMg69Ziz.js";import{t as T}from"./RefreshOutline-DFsFZU2a.js";import{i as Te,r as Ee,t as De}from"./useCompose-Cxsar_gr.js";import"./SyncOutline-DdAvW8IC.js";import{t as Oe}from"./TrashOutline-BLUdX-Eg.js";import{t as ke}from"./container-BbVEwPu1.js";import{f as Ae,l as E}from"./utils-5F9W9oaT.js";import"./compose-BeaxuMAs.js";import{t as je}from"./log-BiY5VKye.js";import"./TermView-Dz1I8qWk.js";import{t as Me}from"./compose-CNk9ZZLk.js";import{n as Ne}from"./hartLine-ca9X-LCq.js";import"./cpu-xpYWQlJU.js";import"./overflowMenuVertical-DNua2xYl.js";var Pe={class:`compose-detail-page`},Fe={class:`page-header`},Ie={class:`flex items-center gap-3`},Le={class:`status-text`},Re={key:0,class:`empty-state`},ze={class:`flex items-center gap-2`},Be={class:`tab-content`},Ve={key:0,class:`empty-container`},He={class:`flex items-center gap-2`},Ue={class:`tab-content yaml-tab`},We={key:1,class:`yaml-card`},Ge={class:`flex justify-end gap-2 items-center px-2 h-[42px]`},Ke={class:`flex items-center gap-2`},qe={class:`tab-content logs-tab`},D=w(t({__name:`ComposeDetailView`,setup(t){let w=S(),D=x(),O=r(),Je=b(),k=g(),A=Me(),j=ke(),M=C(),{isMobile:Ye,isTablet:Xe,isLaptop:Ze,isDesktop:Qe,isDesktopLarge:$e}=fe(),{handleStart:et,handleStop:tt,handleRestart:nt,handleUpdate:rt,handleDelete:it,handleExport:at}=Ne(),{handleStart:ot,handleStop:st,handleDelete:ct,handleRestart:lt}=De(),N=h(w.params.projectName),P=h(`containers`),F=h(!1),I=h(!1),L=h(!1),R=h(``),z=h(``),ut=h(``),dt=h(!0),B=h(!1),V=h(null),ft=h(null),H=h(),U=h(!1),W=h(!1),pt=i(()=>{let e=[],t=G.value?.status;if((t===`exited`||t===`partial`)&&e.push({label:`启动`,key:`start`,icon:E(Ce)}),(t===`running`||t===`partial`)&&e.push({label:`停止`,key:`stop`,icon:E(Se)},{label:`重启`,key:`restart`,icon:E(Te)}),e.push({label:`重新部署`,key:`deploy`,icon:E(T)},{type:`divider`,key:`divider1`},{label:`拉取镜像`,key:`pull`,icon:E(me)}),t!==`unknown`){let n=`删除应用`;(t===`draft`||t===`created_stack`)&&(n=`删除配置`),e.push({type:`divider`,key:`divider2`},{label:n,key:`delete`,icon:E(Oe),props:{style:`color: ${k.value.errorColor}`}})}return e}),mt=async e=>{if(G.value)switch(e){case`deploy`:bt();break;case`start`:await ot(G.value),await j.fetchContainers(!0,!1);break;case`stop`:await st(G.value),await j.fetchContainers(!0,!1);break;case`restart`:await lt(G.value),await j.fetchContainers(!0,!1);break;case`delete`:ct(G.value).then(()=>{$()});break;case`pull`:W.value=!0;break}},G=i(()=>A.projects.find(e=>e.name===N.value)),K=i(()=>j.getProjectContainers(N.value).value),q=i(()=>R.value!==z.value),J=i(()=>42),ht=i(()=>42),gt=i(()=>`calc(100vh - ${M.contentSafeTop+J.value+M.contentSafeBottom}px)`),Y=i(()=>`${document.documentElement.clientHeight-M.contentSafeTop-J.value-ht.value-M.contentSafeBottom}px`),_t=i(()=>{if(!G.value)return;let e=M.getToken();return`${window.location.protocol===`https:`?`wss:`:`ws:`}//${window.location.host}/api/v1/compose/logs/${G.value.name}/ws?token=${e}&composeFile=${encodeURIComponent(G.value.composeFile)}&projectName=${encodeURIComponent(G.value.name)}`}),vt=e=>({running:`运行中`,partial:`部分运行`,exited:`已停止`,paused:`暂停`,draft:`草稿`,created_stack:`创建中`,unknown:`未知`})[e]||`未知`,X=async()=>{try{if(await A.fetchProjects(!0),await j.fetchContainers(!0,!1),!G.value){O.error(`项目不存在`);return}}catch(e){console.error(`加载项目数据失败:`,e),O.error(`加载项目数据失败`)}},Z=async()=>{F.value=!0;try{await X()}catch(e){console.error(`初始化失败:`,e)}finally{F.value=!1}},yt=async()=>{if(G.value){I.value=!0;try{let e=await A.getProjectYaml(G.value.name,G.value.composeFile);R.value=e,z.value=e,Q()}catch(e){console.error(`加载 YAML 内容失败:`,e)}finally{I.value=!1}}},Q=()=>{let e=Ae(R.value);dt.value=e.isValid,ut.value=e.errorMessage},bt=()=>{let e=q.value?`保存 YAML 配置后将重新创建并启动所有服务，这可能会导致服务短暂中断。是否继续？`:`将重新创建并启动所有服务，这可能会导致服务短暂中断。是否继续？`;Je.warning({title:`确认重新部署`,content:e,positiveText:`确认`,negativeText:`取消`,onPositiveClick:()=>{L.value=!0,U.value=!0,H.value?.start()}})},xt=()=>{let e=q.value?`保存并重新部署成功`:`重新部署成功`;O.success(e),z.value=R.value},St=e=>{let t=q.value?`保存并重新部署`:`重新部署`;O.error(`${t}失败: ${e}`),L.value=!1},Ct=()=>{L.value=!1,setTimeout(()=>{X()},1e3)},wt=e=>{P.value=e,e===`yaml`&&!R.value&&yt()},Tt=async e=>{await et(e),await Promise.all([j.fetchContainers(!0,!1),X()])},Et=async e=>{await tt(e),await Promise.all([j.fetchContainers(!0,!1),X()])},Dt=async e=>{await nt(e),await Promise.all([j.fetchContainers(!0,!1),X()])},Ot=async e=>{await rt(e),await Promise.all([j.fetchContainers(!0,!1),X()])},kt=async e=>{await it(e),await Promise.all([j.fetchContainers(!0,!1),X()])},At=async e=>{await at(e)},jt=e=>{D.push({name:`container-detail`,params:{id:e.id}})},Mt=e=>{V.value=e,B.value=!0},$=()=>{D.push({name:`compose`})};return p(()=>w.params.projectName,e=>{e&&typeof e==`string`&&(N.value=e,Z())}),m(async()=>{Z()}),(t,r)=>{let i=te,p=e,m=ie,h=ee,g=le,b=re,x=oe,S=se,C=ue,w=ae;return v(),d(`div`,Pe,[(v(),_(ne,{to:`#header`,defer:``},[o(`div`,Fe,[o(`div`,Ie,[c(p,{text:``,circle:``,onClick:$},{icon:y(()=>[c(i,{size:`20`},{default:y(()=>[c(s(pe))]),_:1})]),_:1}),c(m,{class:`m-0 text-lg`},{default:y(()=>[f(n(N.value),1)]),_:1}),G.value?(v(),d(`div`,{key:0,class:l([`status-badge`,`status-`+G.value.status])},[r[3]||=o(`span`,{class:`status-dot`},null,-1),o(`span`,Le,n(vt(G.value.status)),1)],2)):a(``,!0)]),c(h,{options:pt.value,onSelect:mt,trigger:`click`},{default:y(()=>[c(p,{text:``,circle:``},{icon:y(()=>[c(i,{size:`18`},{default:y(()=>[c(s(be))]),_:1})]),_:1})]),_:1},8,[`options`])])])),F.value?(v(),_(g,{key:0,show:F.value,class:`h-[300px] flex items-center justify-center`},null,8,[`show`])):(v(),d(u,{key:1},[G.value?(v(),_(w,{key:1,type:`line`,animated:``,"pane-class":`compose-detail-pane`,"pane-style":{height:gt.value},"default-value":P.value,"onUpdate:value":wt},{default:y(()=>[c(S,{name:`containers`,tab:`容器`},{tab:y(()=>[o(`div`,ze,[c(i,{size:`18`},{default:y(()=>[c(s(xe))]),_:1}),r[5]||=o(`span`,null,`容器`,-1),K.value.length>0?(v(),_(x,{key:0,value:K.value.length,max:99,"show-zero":``,type:`info`},null,8,[`value`])):a(``,!0)])]),default:y(()=>[o(`div`,Be,[K.value.length===0?(v(),d(`div`,Ve,[c(b,{description:`该项目下没有容器`})])):(v(),d(`div`,{key:1,class:l([`containers-grid`,{"grid-cols-1":s(Ye),"grid-cols-2":s(Xe)||s(Ze),"grid-cols-3":s(Qe),"grid-cols-4":s($e)}])},[(v(!0),d(u,null,ce(K.value,e=>(v(),_(_e,{key:e.id,container:e,onStart:t=>Tt(e),onStop:t=>Et(e),onRestart:t=>Dt(e),onUpdate:t=>Ot(e),onDelete:t=>kt(e),onExport:t=>At(e),onLogs:t=>Mt(e),onDetail:t=>jt(e)},null,8,[`container`,`onStart`,`onStop`,`onRestart`,`onUpdate`,`onDelete`,`onExport`,`onLogs`,`onDetail`]))),128))],2))])]),_:1}),c(S,{name:`yaml`,tab:`配置`},{tab:y(()=>[o(`div`,He,[c(i,{size:`18`},{default:y(()=>[c(s(ve))]),_:1}),r[6]||=o(`span`,null,`配置`,-1)])]),default:y(()=>[o(`div`,Ue,[I.value?(v(),_(g,{key:0,show:I.value,class:`h-full`},null,8,[`show`])):(v(),d(`div`,We,[o(`div`,{ref_key:`yamlEditorContainerRef`,ref:ft,style:{height:`calc(100% - 42px)`}},[c(he,{modelValue:R.value,"onUpdate:modelValue":r[0]||=e=>R.value=e,placeholder:`请输入 docker-compose.yml 配置内容`,"min-height":Y.value,"max-height":Y.value,onChange:Q},null,8,[`modelValue`,`min-height`,`max-height`])],512),o(`div`,Ge,[c(C,{depth:`3`,class:`text-xs`,style:de({color:s(k).errorColor})},{default:y(()=>[f(n(ut.value),1)]),_:1},8,[`style`]),c(p,{type:`primary`,size:`small`,disabled:!dt.value||L.value,loading:L.value,onClick:bt},{icon:y(()=>[c(i,null,{default:y(()=>[c(s(T))]),_:1})]),default:y(()=>[f(` `+n(q.value?`保存并重新部署`:`重新部署`),1)]),_:1},8,[`disabled`,`loading`])])]))])]),_:1}),c(S,{name:`logs`,tab:`日志`},{tab:y(()=>[o(`div`,Ke,[c(i,{size:`18`},{default:y(()=>[c(s(je))]),_:1}),r[7]||=o(`span`,null,`日志`,-1)])]),default:y(()=>[o(`div`,qe,[P.value===`logs`&&G.value?(v(),_(we,{key:0,class:`logs-stream-view`,"socket-url":_t.value,height:`100%`},null,8,[`socket-url`])):a(``,!0)])]),_:1})]),_:1},8,[`pane-style`,`default-value`])):(v(),d(`div`,Re,[c(b,{description:`项目不存在`},{extra:y(()=>[c(p,{onClick:$},{default:y(()=>[...r[4]||=[f(`返回列表`,-1)]]),_:1})]),_:1})]))],64)),c(ye,{show:B.value,"onUpdate:show":r[1]||=e=>B.value=e,container:V.value},null,8,[`show`,`container`]),c(ge,{ref_key:`createProgressRef`,ref:H,show:U.value,"project-name":N.value,"yaml-content":R.value,force:!0,onSuccess:xt,onError:St,onComplete:Ct},null,8,[`show`,`project-name`,`yaml-content`]),c(Ee,{show:W.value,"onUpdate:show":r[2]||=e=>W.value=e,project:G.value||null},null,8,[`show`,`project`])])}}}),[[`__scopeId`,`data-v-b297283f`]]);export{D as default};
//# sourceMappingURL=ComposeDetailView-DhdnrUdf.js.map