import{Gt as e,kn as t}from"./ui-CdsL-WMe.js";import{d as n}from"./common-B7iQJWwr.js";import{i as r}from"./index-KvlnPhMc.js";const i=n(`compose`,()=>{let n=window.$message,i=t([]),a=t(!1),o=t({}),s=e(()=>({total:i.value.length,running:i.value.filter(e=>e.status===`running`).length,exited:i.value.filter(e=>e.status===`exited`).length,draft:i.value.filter(e=>e.status===`draft`).length,createdStack:i.value.filter(e=>e.status===`created_stack`).length})),c=t=>e(()=>o.value[t]||!1),l=(e,t)=>{o.value[e]=t},u=async(e=!1)=>{if(!(a.value&&!e)){a.value=!0;try{let e=await r.getProjects();if(e.code===0)i.value=e.data.projects||[];else throw Error(e.msg||`获取项目列表失败`)}catch(e){throw console.error(`获取 Compose 项目列表失败:`,e),n.error(`获取 Compose 项目列表失败: ${e.message}`),e}finally{a.value=!1}}},d=async(e,t,i)=>{let{refreshAfter:a=!0}=i||{};l(e.name,!0);try{let i,o=``;switch(t){case`start`:i=await r.startProject(e),o=`启动`;break;case`stop`:i=await r.stopProject(e),o=`停止`;break;case`restart`:i=await r.restartProject(e),o=`重启`;break;case`delete`:i=await r.deleteProject(e),o=`删除`;break;case`create`:i=await r.createProject(e),o=`创建`;break;default:throw Error(`未知操作: ${t}`)}if(i.code===0)n.success(`${o}项目成功`),a&&await u(!0);else throw Error(i.msg||`${o}项目失败`)}catch(e){console.error(`执行项目操作失败:`,e);let r={start:`启动`,stop:`停止`,restart:`重新创建`,delete:`删除`,create:`创建`}[t];throw n.error(`${r}项目失败: ${e.message}`),e}finally{l(e.name,!1)}};return{projects:i,loading:a,operationLoading:o,stats:s,isProjectOperating:c,setProjectOperating:l,findProject:t=>e(()=>i.value.find(e=>e.name===t)),fetchProjects:u,executeProjectAction:d,startProject:async e=>d(e,`start`),stopProject:async e=>d(e,`stop`),restartProject:async e=>d(e,`restart`),deleteProject:async e=>d(e,`delete`),createProject:async e=>d(e,`create`),saveNewProject:async(e,t)=>{try{let i=await r.saveNewProject(e,t);if(i.code===0)return n.success(`项目保存成功`),i.data;throw Error(i.msg||`保存项目失败`)}catch(e){throw console.error(`保存项目失败:`,e),n.error(`保存项目失败: ${e.message}`),e}},getProjectLogs:async(e,t=100)=>{try{let n=await r.getProjectLogs(e,t);if(n.code===0)return n.data.logs||``;throw Error(n.msg||`获取日志失败`)}catch(e){throw console.error(`获取项目日志失败:`,e),n.error(`获取项目日志失败: ${e.message}`),e}},getProjectYaml:async(e,t)=>{try{let n=await r.getProjectYaml(e,t);if(n.code===0)return n.data.yamlContent||``;throw Error(n.msg||`获取 YAML 内容失败`)}catch(e){throw console.error(`获取项目 YAML 失败:`,e),n.error(`获取项目 YAML 失败: ${e.message}`),e}},clearAll:()=>{i.value=[],o.value={},a.value=!1}}});export{i as t};
//# sourceMappingURL=compose-CNk9ZZLk.js.map