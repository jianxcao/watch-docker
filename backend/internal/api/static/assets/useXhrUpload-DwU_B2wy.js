import{F as e,kn as t}from"./ui-CdsL-WMe.js";import{t as n}from"./utils-5F9W9oaT.js";function r(){let r=e(),i=t(!1),a=t(0),o=t(0),s=t(0),c=t(``),l=t(``);return{uploading:i,uploadProgress:a,uploadedSize:o,totalSize:s,currentFileName:c,uploadSpeed:l,resetState:()=>{i.value=!1,a.value=0,o.value=0,s.value=0,c.value=``,l.value=``},upload:async e=>{let{url:t,file:u,formData:d=new FormData,getToken:f,onSuccess:p,onError:m}=e;d.has(`file`)||d.append(`file`,u),i.value=!0,c.value=u.name,s.value=u.size;let h=Date.now(),g=0,_=h;return new Promise((e,s)=>{let c=new XMLHttpRequest;c.upload.addEventListener(`progress`,e=>{if(e.lengthComputable){a.value=Math.round(e.loaded/e.total*100),o.value=e.loaded;let t=Date.now(),r=t-_;r>1e3&&(l.value=`${n((e.loaded-g)/(r/1e3))}/s`,g=e.loaded,_=t)}}),c.addEventListener(`load`,()=>{if(i.value=!1,c.status===200)try{let t=JSON.parse(c.responseText);if(t.code===0)p?.(t),e();else{let e=t.msg||`上传失败`;r.error(e),m?.(t),s(Error(e))}}catch(e){console.error(`响应解析失败:`,e);let t=`响应解析失败`;r.error(t),m?.(e),s(Error(t))}else{let e=`上传失败 (${c.status})`;r.error(e),m?.(Error(e)),s(Error(e))}}),c.addEventListener(`error`,()=>{let e=`网络错误`;r.error(e),i.value=!1,m?.(Error(e)),s(Error(e))});try{let e=f?f():``;c.open(`POST`,t),e&&c.setRequestHeader(`Authorization`,`Bearer ${e}`),c.send(d)}catch(e){console.error(`获取token失败:`,e);let t=`获取认证信息失败`;r.error(t),i.value=!1,m?.(e),s(Error(t))}})},formatFileSize:n}}export{r as t};
//# sourceMappingURL=useXhrUpload-DwU_B2wy.js.map