import{$ as e,$t as t,F as n,Gt as r,Kt as i,Ln as a,Qt as o,R as s,U as c,Yt as l,Zt as u,hn as d,in as f,j as p,kn as m,n as h,qt as g,un as _,yn as v,z as y}from"./ui-CdsL-WMe.js";import{n as b}from"./index-KvlnPhMc.js";import{t as x}from"./LogsStreamView-DMg69Ziz.js";import{t as S}from"./RefreshOutline-DFsFZU2a.js";import{t as C}from"./TrashOutline-BLUdX-Eg.js";import{l as w}from"./utils-5F9W9oaT.js";import{t as T}from"./compose-BeaxuMAs.js";import{t as E}from"./compose-CNk9ZZLk.js";var D={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 512 512`},O=t({name:`ReloadOutline`,render:function(e,t){return _(),l(`svg`,D,t[0]||=[i(`path`,{d:`M400 148l-21.12-24.57A191.43 191.43 0 0 0 240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 0 0 181.07-128`,fill:`none`,stroke:`currentColor`,"stroke-linecap":`round`,"stroke-miterlimit":`10`,"stroke-width":`32`},null,-1),i(`path`,{d:`M464 97.42V208a16 16 0 0 1-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z`,fill:`currentColor`},null,-1)])}}),k=t({__name:`ComposePullLogsModal`,props:f({project:{}},{show:{type:Boolean},showModifiers:{}}),emits:[`update:show`],setup(t){let n=t,i=d(t,`show`),l=b(),f=h(),y=m(),E=r(()=>y.value?.isConnecting),D=r(()=>y.value?.isConnected),O=r(()=>n.project?`拉取镜像 - ${n.project.name}`:`拉取镜像`),k=()=>w(T,{color:f.value.primaryColor,size:20}),A=r(()=>{if(!n.project)return;let e=l.getToken();return`${window.location.protocol===`https:`?`wss:`:`ws:`}//${window.location.host}/api/v1/compose/pull/${n.project.name}/ws?token=${e}&composeFile=${encodeURIComponent(n.project.composeFile)}&projectName=${encodeURIComponent(n.project.name)}`}),j=()=>{y.value?.close()},M=()=>{y.value?.handleReconnect()},N=()=>{y.value?.handleClearLogs()};return(n,r)=>{let l=c,d=e,f=p,m=s;return _(),g(m,{show:i.value,"onUpdate:show":r[1]||=e=>i.value=e,icon:k(),"display-directive":`if`,preset:`dialog`,title:O.value,class:`compose-pull-logs-modal`,contentClass:`compose-pull-logs-modal-content`,style:{padding:`8px`,width:`90vw`,maxWidth:`1200px`,height:`90vh`},"mask-closable":!1,closable:!0,onAfterLeave:j},{action:v(()=>[o(f,{justify:`end`},{default:v(()=>[o(d,{onClick:M,disabled:E.value||D.value},{icon:v(()=>[o(l,null,{default:v(()=>[o(a(S))]),_:1})]),default:v(()=>[r[2]||=u(` 重新连接 `,-1)]),_:1},8,[`disabled`]),o(d,{onClick:N},{icon:v(()=>[o(l,null,{default:v(()=>[o(a(C))]),_:1})]),default:v(()=>[r[3]||=u(` 清空日志 `,-1)]),_:1}),o(d,{onClick:r[0]||=e=>i.value=!1},{default:v(()=>[...r[4]||=[u(`关闭`,-1)]]),_:1})]),_:1})]),default:v(()=>[o(x,{ref_key:`logsStreamViewRef`,ref:y,project:t.project,"socket-url":A.value},null,8,[`project`,`socket-url`])]),_:1},8,[`show`,`icon`,`title`])}}}),A=t({__name:`ComposeLogsModal`,props:f({project:{}},{show:{type:Boolean},showModifiers:{}}),emits:[`update:show`],setup(t){let n=t,i=d(t,`show`),l=b(),f=h(),y=m(),E=r(()=>y.value?.isConnecting),D=r(()=>y.value?.isConnected),O=r(()=>n.project?`Compose 日志 - ${n.project.name}`:`Compose 日志`),k=()=>w(T,{color:f.value.primaryColor,size:20}),A=r(()=>{if(!n.project)return;let e=l.getToken();return`${window.location.protocol===`https:`?`wss:`:`ws:`}//${window.location.host}/api/v1/compose/logs/${n.project.name}/ws?token=${e}&composeFile=${encodeURIComponent(n.project.composeFile)}&projectName=${encodeURIComponent(n.project.name)}`}),j=()=>{y.value?.close()},M=()=>{y.value?.handleReconnect()},N=()=>{y.value?.handleClearLogs()};return(n,r)=>{let l=c,d=e,f=p,m=s;return _(),g(m,{show:i.value,"onUpdate:show":r[1]||=e=>i.value=e,icon:k(),"display-directive":`if`,preset:`dialog`,title:O.value,class:`compose-logs-modal`,contentClass:`compose-logs-modal-content`,style:{padding:`8px`,width:`90vw`,maxWidth:`1200px`,height:`90vh`},"mask-closable":!1,closable:!0,onAfterLeave:j},{action:v(()=>[o(f,{justify:`end`},{default:v(()=>[o(d,{onClick:M,disabled:E.value||D.value},{icon:v(()=>[o(l,null,{default:v(()=>[o(a(S))]),_:1})]),default:v(()=>[r[2]||=u(` 重新连接 `,-1)]),_:1},8,[`disabled`]),o(d,{onClick:N},{icon:v(()=>[o(l,null,{default:v(()=>[o(a(C))]),_:1})]),default:v(()=>[r[3]||=u(` 清空日志 `,-1)]),_:1}),o(d,{onClick:r[0]||=e=>i.value=!1},{default:v(()=>[...r[4]||=[u(`关闭`,-1)]]),_:1})]),_:1})]),default:v(()=>[o(x,{ref_key:`logsStreamViewRef`,ref:y,project:t.project,"socket-url":A.value},null,8,[`project`,`socket-url`])]),_:1},8,[`show`,`icon`,`title`])}}});const j=()=>{let e=y(),t=n(),r=E(),i=async(t,n,i)=>i?new Promise((a,o)=>{let s=e.warning({title:`确认操作`,content:i,positiveText:`确认`,negativeText:`取消`,onPositiveClick:async()=>{s.loading=!0;try{await r.executeProjectAction(t,n),a()}catch(e){o(e)}finally{s.loading=!1}},onNegativeClick:()=>{o(Error(`用户取消操作`))}})}):r.executeProjectAction(t,n);return{handleStart:async e=>{try{await i(e,`start`)}catch(e){console.error(`启动项目失败:`,e)}},handleStop:async e=>{try{await i(e,`stop`)}catch(e){console.error(`停止项目失败:`,e)}},handleRestart:async e=>{try{await i(e,`restart`)}catch(e){console.error(`重启项目失败:`,e)}},handleCreate:async e=>{try{await i(e,`create`,`确定要重新创建项目 "${e.name}" 吗？这将停止并删除所有容器，然后重新创建它们。`)}catch(e){console.error(`重新创建项目失败:`,e)}},handleDelete:async e=>{try{await i(e,`delete`,e.status===`draft`||e.status===`created_stack`?`确定要删除项目 "${e.name}" 吗？这将删除该项目的配置文件（草稿）。此操作不可撤销！`:`确定要删除项目 "${e.name}" 吗？这将停止并删除所有容器、网络和卷。此操作不可撤销！`)}catch(e){console.error(`删除项目失败:`,e)}},handleRefresh:async()=>{try{await r.fetchProjects(!0),t.success(`刷新成功`)}catch(e){console.error(`刷新失败:`,e)}},getProjectStatusText:e=>{switch(e){case`running`:return`运行中`;case`stopped`:return`已停止`;case`partial`:return`部分运行`;case`error`:return`错误`;case`unknown`:return`未知`;default:return`未知`}},executeAction:i,ComposeLogsModal:A}};export{O as i,A as n,k as r,j as t};
//# sourceMappingURL=useCompose-Cxsar_gr.js.map