import{r as e}from"./rolldown-runtime-DGruFWvd.js";import{$ as t,$t as n,Bn as r,F as i,Gt as a,H as o,Ht as s,Jt as c,Kt as l,Ln as u,Qt as d,Rn as f,U as p,Ut as m,W as h,Wt as g,Yt as _,Zt as v,at as y,c as b,cn as x,fn as S,it as C,j as w,kn as T,m as E,n as D,nt as ee,o as te,qt as O,tn as k,un as A,yn as j,z as M}from"./ui-CdsL-WMe.js";import{d as N,i as P}from"./common-B7iQJWwr.js";import{d as F,n as I,t as L,v as R}from"./index-KvlnPhMc.js";import{t as ne}from"./useResponsive-C7zPy5Go.js";import{i as re,n as ie,r as ae,t as oe}from"./TextOutline-DfkX3I5u.js";import{t as se}from"./ArchiveOutline-CZXbpvQu.js";import{t as z}from"./CalendarOutline-CiA9mbco.js";import{t as ce}from"./CheckmarkCircleOutline-CNxktTN_.js";import{t as le}from"./CloseCircleOutline-CD61R6IW.js";import{n as B,t as ue}from"./GlobeOutline-Bjt2CxbA.js";import{t as de}from"./HomeOutline-DcVz7_Cy.js";import{t as V}from"./InformationCircleOutline-DxVonW4c.js";import{t as fe}from"./RefreshOutline-DFsFZU2a.js";import{t as pe}from"./SearchOutline-DMbt0-Bv.js";import{t as H}from"./TrashOutline-BLUdX-Eg.js";import{l as U,t as W}from"./utils-5F9W9oaT.js";import{t as G}from"./volume-CnLE4_lm.js";import{t as K}from"./cpu-xpYWQlJU.js";import{t as q}from"./overflowMenuVertical-DNua2xYl.js";const me=N(`volume`,()=>{let e=T([]),t=T(!1),n=a(()=>e.value.filter(e=>e.usageData&&e.usageData.refCount>0)),r=a(()=>e.value.filter(e=>!e.usageData||e.usageData.refCount===0)),i=a(()=>{let t=e.value.reduce((e,t)=>e+(t.usageData?.size||0),0);return{total:e.value.length,used:n.value.length,unused:r.value.length,totalSize:t,formattedTotalSize:W(t)}}),o=async()=>{t.value=!0;try{let t=await F.getVolumes();if(t.code===0)e.value=t.data.volumes||[];else throw console.error(`获取Volume列表失败:`,t.msg),Error(t.msg)}catch(e){throw console.error(`获取Volume列表失败:`,e),e}finally{t.value=!1}};return{volumes:e,loading:t,usedVolumes:n,unusedVolumes:r,stats:i,fetchVolumes:o,createVolume:async e=>{try{let t=await F.createVolume(e);if(t.code===0)return await o(),!0;throw Error(t.msg)}catch(e){throw console.error(`创建Volume失败:`,e),e}},deleteVolume:async(e,t=!1)=>{try{let n=await F.deleteVolume(e,t);if(n.code===0)return await o(),!0;throw Error(n.msg)}catch(e){throw console.error(`删除Volume失败:`,e),e}},pruneVolumes:async()=>{try{let e=await F.pruneVolumes();if(e.code===0)return await o(),e.data;throw Error(e.msg)}catch(e){throw console.error(`清理Volume失败:`,e),e}},findVolumeByName:t=>e.value.find(e=>e.name===t)}});var J=e(R(),1),Y=[`data-theme`],X={key:0,class:`gradient-bar`},Z={class:`card-content`},Q={class:`volume-header`},he={class:`volume-info`},ge={class:`volume-name`},_e={class:`volume-metadata`},ve={class:`metadata-item`},ye={class:`metadata-item`},be={class:`volume-menu`},xe={class:`info-cards`},Se={class:`info-card`},Ce={class:`info-label`},we={class:`info-value`},Te={class:`info-card`},Ee={class:`info-label`},De={class:`info-value-container`},$={class:`info-value`},Oe={key:0,class:`usage-indicator`},ke=L(n({__name:`VolumeCard`,props:{volume:{}},emits:[`delete`,`detail`],setup(e,{emit:n}){let i=I(),m=e,g=D(),y=n,b=a(()=>(m.volume.usageData?.refCount||0)>0),x=e=>e?(0,J.default)(e).format(`YYYY-MM-DD HH:mm`):`-`,S=a(()=>[{key:`detail`,label:`查看详情`,icon:()=>k(p,null,{default:()=>k(V)})},{key:`delete`,label:`删除Volume`,icon:()=>k(p,{color:g.value.errorColor},{default:()=>k(H)})}]),w=e=>{switch(e){case`detail`:y(`detail`);break;case`delete`:y(`delete`);break}},T=()=>{y(`detail`)};return(n,a)=>{let m=h,g=C,y=t,E=o;return A(),_(`div`,{class:f([`volume-card`,{"card-used":b.value}]),"data-theme":u(i).setting.theme,onClick:T},[b.value?(A(),_(`div`,X)):c(``,!0),l(`div`,Z,[l(`div`,Q,[l(`div`,{class:f([`volume-logo`,{"logo-used":b.value}])},[d(u(p),{size:`20`},{default:j(()=>[d(u(G))]),_:1})],2),l(`div`,he,[d(m,{delay:500},{trigger:j(()=>[l(`div`,ge,r(e.volume.name),1)]),default:j(()=>[l(`span`,null,r(e.volume.name),1)]),_:1}),l(`div`,_e,[l(`div`,ve,[d(u(p),{size:`14`},{default:j(()=>[d(u(K))]),_:1}),a[1]||=l(`span`,{class:`metadata-label whitespace-nowrap`},`驱动:`,-1),d(g,{round:``,type:b.value?`success`:`default`,size:`small`,bordered:!0},{default:j(()=>[v(r(e.volume.driver),1)]),_:1},8,[`type`])]),a[3]||=l(`div`,{class:`metadata-divider`},null,-1),l(`div`,ye,[a[2]||=l(`span`,{class:`metadata-label`},`作用域:`,-1),d(g,{round:``,type:`default`,size:`small`,bordered:!0},{default:j(()=>[v(r(e.volume.scope===`local`?`本地`:`全局`),1)]),_:1})])])]),l(`div`,be,[d(E,{options:S.value,onSelect:w,trigger:`click`},{default:j(()=>[d(y,{quaternary:``,circle:``,onClick:a[0]||=s(()=>{},[`stop`])},{icon:j(()=>[d(u(p),null,{default:j(()=>[d(u(q))]),_:1})]),_:1})]),_:1},8,[`options`])])]),l(`div`,xe,[l(`div`,Se,[l(`div`,Ce,[d(u(p),{size:`14`},{default:j(()=>[d(u(z))]),_:1}),a[4]||=l(`span`,null,`创建时间`,-1)]),l(`div`,we,r(x(e.volume.createdAt)),1)]),l(`div`,Te,[l(`div`,Ee,[d(u(p),{size:`14`},{default:j(()=>[d(u(B))]),_:1}),a[5]||=l(`span`,null,`使用容器`,-1)]),l(`div`,De,[l(`div`,$,r(e.volume.usageData?.refCount||0),1),b.value?(A(),_(`div`,Oe)):c(``,!0)])])])])],10,Y)}}}),[[`__scopeId`,`data-v-1dde1c37`]]),Ae={class:`volumes-page`},je={class:`volumes-content`},Me={key:0,class:`empty-state`},Ne={class:`welcome-card`},Pe={class:`flex gap-2`},Fe=L(n({__name:`VolumesView`,setup(e){let n=me(),{isMobile:s,isTablet:c,isLaptop:h,isDesktop:C,isDesktopLarge:D}=ne(),k=P(),N=M(),F=i(),I=T(``),L=T(null),R=T(`name`),B=T(`asc`),V=a(()=>[{label:`全部`,key:null,icon:U(re)},{label:`使用中`,key:`used`,icon:U(ce)},{label:`未使用`,key:`unused`,icon:U(le)},{label:`本地作用域`,key:`local`,icon:U(de)},{label:`全局作用域`,key:`global`,icon:U(ue)}]),W=a(()=>[{label:`名称 ${R.value===`name`?B.value===`asc`?`↑`:`↓`:``}`,key:`name`,icon:U(oe)},{label:`创建时间 ${R.value===`created`?B.value===`asc`?`↑`:`↓`:``}`,key:`created`,icon:U(z)},{label:`大小 ${R.value===`size`?B.value===`asc`?`↑`:`↓`:``}`,key:`size`,icon:U(se)}]),G=e=>{L.value=e},K=a(()=>R.value!==`name`||B.value!==`asc`),q=e=>{R.value===e?B.value=B.value===`asc`?`desc`:`asc`:(R.value=e,B.value=`asc`)},J=a(()=>{let e=n.volumes;if(I.value){let t=I.value.toLowerCase();e=e.filter(e=>{let n=e.name.toLowerCase().includes(t),r=e.driver.toLowerCase().includes(t),i=e.mountpoint.toLowerCase().includes(t);return n||r||i})}return L.value&&(e=e.filter(e=>{switch(L.value){case`used`:return e.usageData&&e.usageData.refCount>0;case`unused`:return!e.usageData||e.usageData.refCount===0;case`local`:return e.scope===`local`;case`global`:return e.scope===`global`;default:return!0}})),e.sort((e,t)=>{let n=0;switch(R.value){case`name`:n=e.name.localeCompare(t.name);break;case`created`:n=new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime();break;case`size`:n=(e.usageData?.size||0)-(t.usageData?.size||0);break;default:n=0}return B.value===`asc`?n:-n})}),Y=async e=>{let t=e.usageData?.refCount||0;if(t>0){N.warning({title:`无法删除`,content:`此 Volume 正在被 ${t} 个容器使用，无法删除。请先停止或删除使用该 Volume 的容器。`,positiveText:`知道了`});return}let r=N.warning({title:`确认删除`,content:`确定要删除 Volume "${e.name}" 吗？此操作不可恢复。`,positiveText:`删除`,negativeText:`取消`,onPositiveClick:async()=>{try{r.loading=!0,await n.deleteVolume(e.name,!1),F.success(`Volume 删除成功`)}catch(e){F.error(`删除失败：${e.message||`未知错误`}`)}finally{r.loading=!1}}})},X=e=>{k.push(`/volumes/${e.name}`)},Z=async()=>{try{await n.fetchVolumes()}catch(e){F.error(`刷新失败：${e.message||`未知错误`}`)}},Q=()=>{let e=n.unusedVolumes.length;if(e===0){F.info(`没有未使用的 Volume 需要清理`);return}let t=N.warning({title:`确认清理`,content:`确定要清理 ${e} 个未使用的 Volume 吗？此操作不可恢复。`,positiveText:`清理`,negativeText:`取消`,onPositiveClick:async()=>{try{t.loading=!0;let e=(await n.pruneVolumes()).volumesDeleted?.length||0;F.success(`清理成功，删除了 ${e} 个 Volume`)}catch(e){F.error(`清理失败：${e.message||`未知错误`}`)}finally{t.loading=!1}}})};return x(async()=>{await n.fetchVolumes()}),(e,i)=>{let a=p,x=t,T=o,k=ee,M=w,N=y,P=E,F=b,R=te;return A(),_(`div`,Ae,[d(M,null,{default:j(()=>[d(T,{options:V.value,onSelect:G},{default:j(()=>[d(x,{circle:``,size:`small`,type:L.value?`primary`:`default`},{icon:j(()=>[d(a,null,{default:j(()=>[d(u(ae))]),_:1})]),_:1},8,[`type`])]),_:1},8,[`options`]),d(T,{options:W.value,onSelect:q},{default:j(()=>[d(x,{circle:``,size:`small`,type:K.value?`primary`:`default`},{icon:j(()=>[d(a,null,{default:j(()=>[d(u(ie))]),_:1})]),_:1},8,[`type`])]),_:1},8,[`options`]),d(k,{value:I.value,"onUpdate:value":i[0]||=e=>I.value=e,placeholder:`名称、驱动或挂载点`,clearable:``,class:`lg:w-[400px]!`},{prefix:j(()=>[d(a,null,{default:j(()=>[d(u(pe))]),_:1})]),_:1},8,[`value`])]),_:1}),l(`div`,je,[d(P,{show:u(n).loading&&J.value.length===0},{default:j(()=>[J.value.length===0&&!u(n).loading?(A(),_(`div`,Me,[d(N,{description:`没有找到 Volume`},{extra:j(()=>[d(x,{onClick:Z},{default:j(()=>[...i[1]||=[v(`刷新数据`,-1)]]),_:1})]),_:1})])):(A(),_(`div`,{key:1,class:f([`volumes-grid`,{"grid-cols-1":u(s),"grid-cols-2":u(c),"grid-cols-3":u(h)||u(C),"grid-cols-4":u(D)}])},[(A(!0),_(m,null,S(J.value,e=>(A(),O(ke,{key:e.name,volume:e,onDelete:()=>Y(e),onDetail:()=>X(e)},null,8,[`volume`,`onDelete`,`onDetail`]))),128))],2))]),_:1},8,[`show`])]),(A(),O(g,{to:`#header`,defer:``},[l(`div`,Ne,[l(`div`,null,[d(F,{class:`m-0 text-lg`},{default:j(()=>[...i[2]||=[v(`Volume 管理`,-1)]]),_:1}),d(R,{depth:`3`,class:`text-xs max-md:hidden`},{default:j(()=>[v(` 共 `+r(u(n).stats.total)+` 个 Volume， 总大小 `+r(u(n).stats.formattedTotalSize)+`， 使用中 `+r(u(n).stats.used)+` 个 `,1)]),_:1})]),l(`div`,Pe,[d(x,{onClick:Z,loading:u(n).loading,circle:``,size:`tiny`},{icon:j(()=>[d(a,null,{default:j(()=>[d(u(fe))]),_:1})]),_:1},8,[`loading`]),d(x,{onClick:Q,circle:``,tertiary:``,size:`tiny`},{icon:j(()=>[d(a,null,{default:j(()=>[d(u(H))]),_:1})]),_:1})])])]))])}}}),[[`__scopeId`,`data-v-b2882896`]]);export{Fe as default};
//# sourceMappingURL=VolumesView-C2p9bhlO.js.map