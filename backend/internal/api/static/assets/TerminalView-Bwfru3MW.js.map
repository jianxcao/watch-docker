{"version":3,"file":"TerminalView-Bwfru3MW.js","names":["_hoisted_1","_openBlock","_createElementBlock","_createElementVNode"],"sources":["../../src/assets/svg/textClear.svg?component","../../src/pages/TerminalView.vue","../../src/pages/TerminalView.vue"],"sourcesContent":["import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nconst _hoisted_1 = {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 32 32\"\n}\n\nexport function render(_ctx, _cache) {\n  return (_openBlock(), _createElementBlock(\"svg\", _hoisted_1, [...(_cache[0] || (_cache[0] = [\n    _createElementVNode(\"path\", {\n      fill: \"currentColor\",\n      d: \"m29.438 16.572-7.985-7.986a2 2 0 0 0-2.829 0l-5.358 5.358L9 2H7L2 16h2l.999-3h6l.803 2.408-7.216 7.216a2 2 0 0 0 0 2.829L9.132 30h9.59l10.716-10.717a1.917 1.917 0 0 0 0-2.712zM5.665 11l2.331-7 2.336 7zm12.23 17H9.96L6 24.038l6.312-6.311 7.928 7.927zm3.76-3.76-7.928-7.927L20.039 10l7.927 7.927z\"\n    }, null, -1)\n  ]))]))\n}\nexport default { render: render }","<template>\n  <div class=\"terminal-page\">\n    <div class=\"terminal-container\">\n      <div v-if=\"connectionError\" class=\"terminal-error\">\n        <n-icon size=\"48\" :color=\"theme.errorColor\">\n          <CloseCircleOutline />\n        </n-icon>\n        <n-text>{{ connectionError }}</n-text>\n        <n-button type=\"primary\" size=\"small\" @click=\"reconnect\" :loading=\"connecting\">\n          重新连接\n        </n-button>\n      </div>\n      <TermView\n        v-if=\"!connectionError\"\n        ref=\"termRef\"\n        :config=\"termConfig\"\n        :height=\"termHeight\"\n        @ready=\"handleTermReady\"\n        @data=\"handleTermData\"\n        @resize=\"handleTermResize\"\n      />\n    </div>\n\n    <!-- 页面标题信息 -->\n    <Teleport to=\"#header\" defer>\n      <div class=\"welcome-card\">\n        <div class=\"terminal-title\">\n          <n-icon :color=\"theme.primaryColor\">\n            <TerminalOutline />\n          </n-icon>\n          <span>终端</span>\n        </div>\n        <div class=\"terminal-actions\">\n          <n-button circle size=\"tiny\" @click=\"reconnect\" :loading=\"connecting\">\n            <template #icon>\n              <n-icon>\n                <RefreshOutline />\n              </n-icon>\n            </template>\n          </n-button>\n          <n-button circle size=\"tiny\" @click=\"clearTerminal\">\n            <template #icon>\n              <n-icon>\n                <TextClearIcon />\n              </n-icon>\n            </template>\n          </n-button>\n        </div>\n      </div>\n    </Teleport>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed } from 'vue'\nimport { useWebSocket } from '@vueuse/core'\nimport { useMessage, useThemeVars } from 'naive-ui'\nimport { RefreshOutline, CloseCircleOutline, TerminalOutline } from '@vicons/ionicons5'\nimport TextClearIcon from '@/assets/svg/textClear.svg?component'\nimport TermView from '@/components/Term/TermView.vue'\nimport type { Terminal } from '@xterm/xterm'\nimport { useSettingStore } from '@/store/setting'\n\nconst theme = useThemeVars()\nconst message = useMessage()\nconst settingStore = useSettingStore()\nconst termRef = ref<InstanceType<typeof TermView>>()\nconst terminal = ref<Terminal>()\nconst connectionError = ref<string>('')\nconst connecting = ref(false)\nconst isTerminalReady = ref(false)\n\n// 终端配置\nconst termConfig = {\n  disableStdin: false, // 启用输入\n  cursorBlink: true,\n  convertEol: true,\n  scrollback: 10000,\n  fontSize: 14,\n  // 添加支持中文的字体 - 等宽字体优先，中文字体作为后备\n  fontFamily:\n    'Menlo, Monaco, \"Courier New\", monospace, \"Microsoft YaHei\", \"微软雅黑\", \"PingFang SC\", \"Hiragino Sans GB\", \"Heiti SC\", \"WenQuanYi Micro Hei\", sans-serif',\n  fontWeight: 'normal',\n  fontWeightBold: 'bold',\n  letterSpacing: 0,\n  lineHeight: 1.2,\n}\n\n// 计算终端高度\nconst termHeight = computed(() => {\n  return `calc(100vh - ${settingStore.contentSafeTop + settingStore.contentSafeBottom}px)`\n})\n\nconst socketUrl = computed(() => {\n  const token = settingStore.getToken()\n  const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:'\n  const host = window.location.host\n  return `${protocol}//${host}/api/v1/shell?token=${token}`\n})\n\n// 使用 VueUse 的 useWebSocket\nconst {\n  status,\n  send,\n  open: openWs,\n  close: closeWs,\n} = useWebSocket(socketUrl, {\n  autoReconnect: false,\n  immediate: false,\n  // 直接处理消息事件，支持二进制数据\n  onMessage: (_ws, event) => {\n    if (terminal.value && event.data) {\n      terminal.value.write(new Uint8Array(event.data))\n    }\n  },\n  onConnected: (_ws) => {\n    connecting.value = false\n    connectionError.value = ''\n    // 设置二进制类型为 arraybuffer\n    if (_ws) {\n      _ws.binaryType = 'arraybuffer'\n    }\n  },\n  onDisconnected: () => {\n    connecting.value = false\n    if (isTerminalReady.value && !connectionError.value) {\n      message.warning('终端连接已断开')\n    }\n  },\n  onError: () => {\n    connecting.value = false\n    connectionError.value = 'WebSocket 连接失败'\n    message.error('无法连接到终端')\n  },\n})\n\n// 终端准备就绪\nconst handleTermReady = (term: Terminal) => {\n  terminal.value = term\n  isTerminalReady.value = true\n\n  // 显示欢迎消息\n  term.writeln('\\x1b[1;32m=== 欢迎使用 Web Terminal ===\\x1b[0m')\n  term.writeln('\\x1b[90m正在连接到远程 Shell...\\x1b[0m')\n  term.writeln('')\n\n  // 连接 WebSocket\n  connecting.value = true\n  openWs()\n}\n\n// 处理用户输入\nconst handleTermData = (data: string) => {\n  if (status.value === 'OPEN') {\n    send(data)\n  }\n}\n\n// 处理终端大小变化\nconst handleTermResize = (size: { cols: number; rows: number }) => {\n  // 如果需要通知后端终端大小变化，可以在这里发送消息\n  console.log('Terminal resized:', size)\n}\n\n// 重新连接\nconst reconnect = () => {\n  if (connecting.value) {\n    return\n  }\n  connecting.value = true\n  connectionError.value = ''\n\n  // 关闭现有连接\n  closeWs()\n\n  // 清空终端\n  if (termRef.value) {\n    termRef.value.clear()\n  }\n\n  // 重新连接\n  if (terminal.value) {\n    terminal.value.writeln('\\x1b[1;32m=== 重新连接... ===\\x1b[0m')\n    terminal.value.writeln('')\n  }\n\n  setTimeout(() => {\n    openWs()\n  }, 100)\n}\n\n// 清空终端\nconst clearTerminal = () => {\n  if (termRef.value) {\n    termRef.value.clear()\n  }\n}\n\n// 组件卸载时清理\nonUnmounted(() => {\n  closeWs()\n})\n</script>\n<style lang=\"less\">\n.layout-terminal {\n  .n-layout-scroll-container {\n    overflow: hidden;\n  }\n}\n</style>\n<style scoped lang=\"less\">\n.welcome-card {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  flex-direction: row;\n  height: 100%;\n  .terminal-title {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    color: var(--text-color);\n    font-size: 14px;\n    font-weight: 500;\n  }\n}\n\n.terminal-page {\n  display: flex;\n  flex-direction: column;\n}\n\n.terminal-container {\n  flex: 1;\n  position: relative;\n  overflow: hidden;\n}\n\n.terminal-actions {\n  display: flex;\n  gap: 8px;\n}\n\n.terminal-error {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  gap: 16px;\n  font-size: 14px;\n}\n</style>\n","<template>\n  <div class=\"terminal-page\">\n    <div class=\"terminal-container\">\n      <div v-if=\"connectionError\" class=\"terminal-error\">\n        <n-icon size=\"48\" :color=\"theme.errorColor\">\n          <CloseCircleOutline />\n        </n-icon>\n        <n-text>{{ connectionError }}</n-text>\n        <n-button type=\"primary\" size=\"small\" @click=\"reconnect\" :loading=\"connecting\">\n          重新连接\n        </n-button>\n      </div>\n      <TermView\n        v-if=\"!connectionError\"\n        ref=\"termRef\"\n        :config=\"termConfig\"\n        :height=\"termHeight\"\n        @ready=\"handleTermReady\"\n        @data=\"handleTermData\"\n        @resize=\"handleTermResize\"\n      />\n    </div>\n\n    <!-- 页面标题信息 -->\n    <Teleport to=\"#header\" defer>\n      <div class=\"welcome-card\">\n        <div class=\"terminal-title\">\n          <n-icon :color=\"theme.primaryColor\">\n            <TerminalOutline />\n          </n-icon>\n          <span>终端</span>\n        </div>\n        <div class=\"terminal-actions\">\n          <n-button circle size=\"tiny\" @click=\"reconnect\" :loading=\"connecting\">\n            <template #icon>\n              <n-icon>\n                <RefreshOutline />\n              </n-icon>\n            </template>\n          </n-button>\n          <n-button circle size=\"tiny\" @click=\"clearTerminal\">\n            <template #icon>\n              <n-icon>\n                <TextClearIcon />\n              </n-icon>\n            </template>\n          </n-button>\n        </div>\n      </div>\n    </Teleport>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed } from 'vue'\nimport { useWebSocket } from '@vueuse/core'\nimport { useMessage, useThemeVars } from 'naive-ui'\nimport { RefreshOutline, CloseCircleOutline, TerminalOutline } from '@vicons/ionicons5'\nimport TextClearIcon from '@/assets/svg/textClear.svg?component'\nimport TermView from '@/components/Term/TermView.vue'\nimport type { Terminal } from '@xterm/xterm'\nimport { useSettingStore } from '@/store/setting'\n\nconst theme = useThemeVars()\nconst message = useMessage()\nconst settingStore = useSettingStore()\nconst termRef = ref<InstanceType<typeof TermView>>()\nconst terminal = ref<Terminal>()\nconst connectionError = ref<string>('')\nconst connecting = ref(false)\nconst isTerminalReady = ref(false)\n\n// 终端配置\nconst termConfig = {\n  disableStdin: false, // 启用输入\n  cursorBlink: true,\n  convertEol: true,\n  scrollback: 10000,\n  fontSize: 14,\n  // 添加支持中文的字体 - 等宽字体优先，中文字体作为后备\n  fontFamily:\n    'Menlo, Monaco, \"Courier New\", monospace, \"Microsoft YaHei\", \"微软雅黑\", \"PingFang SC\", \"Hiragino Sans GB\", \"Heiti SC\", \"WenQuanYi Micro Hei\", sans-serif',\n  fontWeight: 'normal',\n  fontWeightBold: 'bold',\n  letterSpacing: 0,\n  lineHeight: 1.2,\n}\n\n// 计算终端高度\nconst termHeight = computed(() => {\n  return `calc(100vh - ${settingStore.contentSafeTop + settingStore.contentSafeBottom}px)`\n})\n\nconst socketUrl = computed(() => {\n  const token = settingStore.getToken()\n  const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:'\n  const host = window.location.host\n  return `${protocol}//${host}/api/v1/shell?token=${token}`\n})\n\n// 使用 VueUse 的 useWebSocket\nconst {\n  status,\n  send,\n  open: openWs,\n  close: closeWs,\n} = useWebSocket(socketUrl, {\n  autoReconnect: false,\n  immediate: false,\n  // 直接处理消息事件，支持二进制数据\n  onMessage: (_ws, event) => {\n    if (terminal.value && event.data) {\n      terminal.value.write(new Uint8Array(event.data))\n    }\n  },\n  onConnected: (_ws) => {\n    connecting.value = false\n    connectionError.value = ''\n    // 设置二进制类型为 arraybuffer\n    if (_ws) {\n      _ws.binaryType = 'arraybuffer'\n    }\n  },\n  onDisconnected: () => {\n    connecting.value = false\n    if (isTerminalReady.value && !connectionError.value) {\n      message.warning('终端连接已断开')\n    }\n  },\n  onError: () => {\n    connecting.value = false\n    connectionError.value = 'WebSocket 连接失败'\n    message.error('无法连接到终端')\n  },\n})\n\n// 终端准备就绪\nconst handleTermReady = (term: Terminal) => {\n  terminal.value = term\n  isTerminalReady.value = true\n\n  // 显示欢迎消息\n  term.writeln('\\x1b[1;32m=== 欢迎使用 Web Terminal ===\\x1b[0m')\n  term.writeln('\\x1b[90m正在连接到远程 Shell...\\x1b[0m')\n  term.writeln('')\n\n  // 连接 WebSocket\n  connecting.value = true\n  openWs()\n}\n\n// 处理用户输入\nconst handleTermData = (data: string) => {\n  if (status.value === 'OPEN') {\n    send(data)\n  }\n}\n\n// 处理终端大小变化\nconst handleTermResize = (size: { cols: number; rows: number }) => {\n  // 如果需要通知后端终端大小变化，可以在这里发送消息\n  console.log('Terminal resized:', size)\n}\n\n// 重新连接\nconst reconnect = () => {\n  if (connecting.value) {\n    return\n  }\n  connecting.value = true\n  connectionError.value = ''\n\n  // 关闭现有连接\n  closeWs()\n\n  // 清空终端\n  if (termRef.value) {\n    termRef.value.clear()\n  }\n\n  // 重新连接\n  if (terminal.value) {\n    terminal.value.writeln('\\x1b[1;32m=== 重新连接... ===\\x1b[0m')\n    terminal.value.writeln('')\n  }\n\n  setTimeout(() => {\n    openWs()\n  }, 100)\n}\n\n// 清空终端\nconst clearTerminal = () => {\n  if (termRef.value) {\n    termRef.value.clear()\n  }\n}\n\n// 组件卸载时清理\nonUnmounted(() => {\n  closeWs()\n})\n</script>\n<style lang=\"less\">\n.layout-terminal {\n  .n-layout-scroll-container {\n    overflow: hidden;\n  }\n}\n</style>\n<style scoped lang=\"less\">\n.welcome-card {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  flex-direction: row;\n  height: 100%;\n  .terminal-title {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    color: var(--text-color);\n    font-size: 14px;\n    font-weight: 500;\n  }\n}\n\n.terminal-page {\n  display: flex;\n  flex-direction: column;\n}\n\n.terminal-container {\n  flex: 1;\n  position: relative;\n  overflow: hidden;\n}\n\n.terminal-actions {\n  display: flex;\n  gap: 8px;\n}\n\n.terminal-error {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  gap: 16px;\n  font-size: 14px;\n}\n</style>\n"],"mappings":"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"}