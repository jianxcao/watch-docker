# Watch Docker 业务配置文件
# 此文件用于配置 Docker 相关的业务逻辑（扫描、通知、服务器等）
#
# 配置文件说明：
#   - config.yaml     - Docker 业务配置（本文件，扫描、通知、服务器等）
#   - app.yaml        - 应用环境配置（用户名密码、功能开关等）
#
# 路径: ~/.watch-docker/config.yaml
# 所有配置都可以通过环境变量覆盖（使用 WATCH_ 前缀）

# =============================================================================
# 服务器配置
# =============================================================================
server:
  # HTTP 服务监听地址和端口
  addr: ":8080"
  
  # 超时设置（可选）
  # read_timeout: 30s
  # write_timeout: 30s

# =============================================================================
# Docker 连接配置
# =============================================================================
docker:
  # Docker API 访问地址（空则使用默认：unix:///var/run/docker.sock）
  host: ""
  
  # 是否包含已停止的容器
  includeStopped: false

# =============================================================================
# 容器扫描配置
# =============================================================================
scan:
  # 使用 cron 表达式触发扫描（与 interval 二选一）
  # 例如："0 */1 * * *" 表示每小时执行一次
  cron: "0 */1 * * *"
  
  # 并发获取远端 digest 的 worker 数
  concurrency: 5
  
  # registry 远端 digest 的缓存 TTL（分钟）
  cacheTTL: 60
  
  # 是否自动更新容器
  isUpdate: false
  
  # 是否允许 Compose 项目更新
  allowComposeUpdate: false

# =============================================================================
# 策略配置
# =============================================================================
policy:
  # 跳过的标签（容器标签匹配时不扫描）
  skipLabels: []
  
  # 只扫描的标签（只扫描匹配这些标签的容器）
  onlyLabels: []
  
  # 跳过本地构建的镜像
  skipLocalBuild: true
  
  # 跳过固定 digest 的镜像
  skipPinnedDigest: true
  
  # 跳过 semver 固定版本的镜像
  skipSemverPinned: false
  
  # 浮动标签（这些 tag 会被检查更新）
  floatingTags:
    - "latest"
    - "stable"
    - "edge"

# =============================================================================
# Registry 配置
# =============================================================================
registry:
  # Registry 认证配置（支持多个）
  auth:
    # Docker Hub 示例
    - host: "docker.io"  # 或 "dockerhub"
      username: ""
      token: ""
    
    # GitHub Container Registry 示例
    # - host: "ghcr.io"
    #   username: "your-username"
    #   token: "your-token"
    
    # 私有 Registry 示例
    # - host: "registry.example.com"
    #   username: "admin"
    #   token: "password"

# =============================================================================
# 通知配置
# =============================================================================
notify:
  # Webhook 通知 URL（留空则禁用通知）
  url: ""
  
  # HTTP 请求方法（GET 或 POST）
  method: "POST"
  
  # 自定义请求头（可选）
  # headers:
  #   Authorization: "Bearer token"
  #   Content-Type: "application/json"

# =============================================================================
# 配置说明
# =============================================================================
#
# 1. 配置文件职责分离：
#    - config.yaml（本文件）   - Docker 业务配置（扫描、通知、服务器等）
#    - app.yaml                - 应用环境配置（认证、功能开关等）
#
# 2. 配置优先级（从高到低）：
#    环境变量 > 配置文件 > 默认值
#
# 3. 环境变量使用 WATCH_ 前缀，例如：
#    export WATCH_SERVER_ADDR=":9090"
#    export WATCH_SCAN_CONCURRENCY=10
#
# 4. 修改配置后需要重启服务：
#    systemctl restart watch-docker
#    或直接重启应用
#
# 5. 安全建议：
#    - Registry token 建议使用环境变量而非配置文件
#    - 设置配置文件权限：chmod 600 ~/.watch-docker/config.yaml
#    - 限制配置目录访问：chmod 700 ~/.watch-docker
#
# 6. 更多配置选项和说明，请参考：
#    - doc/configuration-guide.md  - 完整配置指南
#    - app.yaml.example            - 应用环境配置示例
#
# =============================================================================
